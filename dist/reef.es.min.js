/*! reef v13.0.0 | (c) 2023 Chris Ferdinandi | MIT License | http://github.com/cferdinandi/reef */
function e(e,t,n=document){let i=new CustomEvent(`reef:${e}`,{bubbles:!0,cancelable:!0,detail:t});return n.dispatchEvent(i)}function t(e){return"string"==typeof e?document.querySelector(e):e}function n(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function i(t,r){let o="signal"+(t?`-${t}`:"");return{get:(e,r)=>"_isSignal"===r||(["object","array"].includes(n(e[r]))&&!e[r]._isSignal&&(e[r]=new Proxy(e[r],i(t))),e[r]),set:(t,n,i)=>(t[n]===i||(t[n]=i,e(o,{prop:n,value:i,action:"set"})),!0),deleteProperty:(t,n)=>(delete t[n],e(o,{prop:n,value:t[n],action:"delete"}),!0)}}function r(e={},t=""){return e=["array","object"].includes(n(e))?e:{value:e},new Proxy(e,i(t))}class o{constructor(t,n,i=""){let r="signal"+(i?`-${i}`:"");Object.defineProperties(this,{value:{get:()=>structuredClone(t),set:()=>!0}});for(let i in n)"function"==typeof n[i]&&(this[i]=function(...o){n[i](t,...o),e(r,t)})}}function l(e={},t={},n=""){return new o(e,t,n)}let s=["input","option","textarea"],u=["value","checked","selected"],c=["checked","selected"];function d(e){return["false","null","undefined","0","-0","NaN","0n","-0n"].includes(e)}function a(e,t,n,i){if(!t.startsWith("on")||!i)return;if(e[t])return;let r=i[n.split("(")[0]];r&&(e[t]=r)}function f(e,t){let n=t.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!n.includes("javascript:")&&!n.includes("data:text/html"))||(!!(e.startsWith("on")||e.startsWith("@on")||e.startsWith("#on"))||void 0)}function h(e,t,n,i){a(e,t,n,i),f(t,n)||(u.includes(t)&&(e[t]="value"===t?n:" "),e.setAttribute(t,n))}function g(e,t){u.includes(t)&&(e[t]=""),e.removeAttribute(t)}function m(e,t){if(1===e.nodeType){for(let{name:n,value:i}of e.attributes){if(f(n,i)){g(e,n),a(e,n,i,t);continue}if(!n.startsWith("@")&&!n.startsWith("#"))continue;let r=n.slice(1);g(e,n),c.includes(r)&&d(i)||h(e,r,i,t)}if(e.childNodes)for(let n of e.childNodes)m(n,t)}}function p(e){return e.childNodes&&e.childNodes.length?null:e.textContent}function b(e,t,n){let i=e.childNodes,r=t.childNodes;(function(e){let t=e.querySelectorAll("script");for(let e of t)e.remove()})(e)||(i.forEach((function(e,i){if(!r[i]){let i=e.cloneNode(!0);return m(i,n),void t.append(i)}if(o=e,l=r[i],"number"==typeof o.nodeType&&o.nodeType!==l.nodeType||"string"==typeof o.tagName&&o.tagName!==l.tagName||"string"==typeof o.id&&o.id&&o.id!==l.id||"getAttribute"in o&&"getAttribute"in l&&o.getAttribute("key")!==l.getAttribute("key")||"string"==typeof o.src&&o.src&&o.src!==l.src){let o=function(e,t){if(1!==e.nodeType)return;let n=e.getAttribute("id"),i=e.getAttribute("key");if(!n||!i)return;let r=n?`#${n}`:`[key="${i}"]`;return t.querySelector(`:scope > ${r}`)}(e,t);if(!o){let t=e.cloneNode(!0);return m(t,n),void r[i].before(t)}r[i].before(o)}var o,l;if("hasAttribute"in e&&e.hasAttribute("reef-ignore"))return;if(function(e,t,n){if(1!==e.nodeType)return;let i=e.attributes,r=t.attributes;for(let{name:r,value:o}of i){if(r.startsWith("#"))continue;if(u.includes(r)&&s.includes(e.tagName.toLowerCase()))continue;let i=r.startsWith("@")?r.slice(1):r;c.includes(i)&&d(o)?g(t,i):h(t,i,o,n)}for(let{name:e,value:n}of r)i[e]||u.includes(e)&&s.includes(t.tagName.toLowerCase())||g(t,e)}(e,r[i],n),e.nodeName.includes("-"))return;let a=p(e);if(a&&a!==p(r[i])&&(r[i].textContent=a),e.childNodes.length||!r[i].childNodes.length){if(!r[i].childNodes.length&&e.childNodes.length){let t=document.createDocumentFragment();return b(e,t,n),void r[i].appendChild(t)}e.childNodes.length&&b(e,r[i],n)}else r[i].innerHTML=""})),function(e,t){let n=e.length-t.length;if(!(n<1))for(;n>0;n--)e[e.length-1].remove()}(r,i))}function y(n,i,r){let o=t(n),l=function(e){let t=(new DOMParser).parseFromString(e,"text/html");return t.head&&t.head.childNodes.length&&Array.from(t.head.childNodes).reverse().forEach((function(e){t.body.insertBefore(e,t.body.firstChild)})),t.body||document.createElement("body")}(i);e("before-render",null,o)&&(b(l,o,r),e("render",null,o))}class v{constructor(e,t,n){var i;this.elem=e,this.template=t,this.signals=n.signals?n.signals.map((e=>`reef:signal-${e}`)):["reef:signal"],this.events=n.events,this.handler=(i=this,function(e){i.render()}),this.debounce=null,this.start()}start(){for(let e of this.signals)document.addEventListener(e,this.handler);this.render(),e("start",null,t(this.elem))}stop(){for(let e of this.signals)document.removeEventListener(e,this.handler);e("stop",null,t(this.elem))}render(){let e=this;e.debounce&&window.cancelAnimationFrame(e.debounce),e.debounce=window.requestAnimationFrame((function(){y(e.elem,e.template(),e.events)}))}}function N(e,t,n={}){return new v(e,t,n)}export{N as component,y as render,r as signal,l as store};
//# sourceMappingURL=reef.es.min.js.map
